

<div v-if="DiscountBox.Display" class="coupon-box">
    <h2 class="h5">
        <strong>
            @T("ShoppingCart.DiscountCouponCode.Tooltip")
        </strong>
    </h2>
    <div class="coupon-code">
        <div class="form-group">
            <span class="col-form-label">@T("ShoppingCart.DiscountCouponCode")</span>
            <div class="input-group">
                <input type="text" id="discountcouponcode" name="discountcouponcode" class="form-control discount-coupon-code">
                <label for="discountcouponcode" class="sr-only">@T("ShoppingCart.GiftCardCouponCode.Button")</label>
                <span class="input-group-append">
                    <button type="button" name="applydiscountcouponcode" id="applydiscountcouponcode" onclick="ApplyDiscountCode(this)" class="btn btn-outline-secondary apply-discount-coupon-code-button"
                            data-href="@Url.RouteUrl("ApplyDiscountCoupon")">
                        @T("ShoppingCart.DiscountCouponCode.Button")
                    </button>
                </span>
            </div>
        </div>
    </div>

    <div v-if="DiscountBox.Message !== null && DiscountBox.IsApplied" class="alert alert-success message-success text-center">
        {{DiscountBox.Message}}
    </div>
    <div v-if="DiscountBox.Message !== null && DiscountBox.IsApplied == false" class="alert alert-danger message-failure text-center">
        {{DiscountBox.Message}}
    </div>
        <div v-if="DiscountBox.AppliedDiscountsWithCodes[0]" v-for="discount in DiscountBox.AppliedDiscountsWithCodes" class="alert alert-success text-center">
            <span>@T("ShoppingCart.DiscountCouponCode.CurrentCode") {{discount.CouponCode}}</span>
            <b-link name="removediscount"
                    :data-href="'/removediscountcoupon?discountId=' + discount.Id"
                    title="@T("Common.Remove")"
                    class="mx-1"
                    onclick="ApplyDiscountCode(this)">
                <b-icon icon="trash" variant="danger"></b-icon>
            </b-link>
        </div>
</div>
    <script asp-location="Footer">
            function ApplyDiscountCode(e) {
                var href = e.getAttribute('data-href');
                var DiscountCodeData = {
                    giftcardcouponcode: document.getElementById('discountcouponcode').value,
                };
                addAntiForgeryToken(DiscountCodeData);
                var bodyFormData = new FormData();
                bodyFormData.append('discountcouponcode', document.getElementById('discountcouponcode').value);
                bodyFormData.append('__RequestVerificationToken', document.querySelector('input[name=__RequestVerificationToken]').value);
                axios({
                    method: 'post',
                    url: href,
                    data: bodyFormData,
                    headers: { 'Content-Type': 'multipart/form-data' }
                }).then(function (response) {
                    var cartall = response.data.cart;
                    var newcart = JSON.parse(cartall);
                    vm.ButtonPaymentMethodViewComponentNames = newcart.ButtonPaymentMethodViewComponentNames,
                        vm.CheckoutAttributeInfo = newcart.CheckoutAttributeInfo,
                        vm.CheckoutAttributes = newcart.CheckoutAttributes,
                        vm.DiscountBox = newcart.DiscountBox,
                        vm.DisplayTaxShippingInfo = newcart.DisplayTaxShippingInfo,
                        vm.GiftCardBox = newcart.GiftCardBox,
                        vm.IsAllowOnHold = newcart.IsAllowOnHold,
                        vm.IsGuest = newcart.IsGuest,
                        vm.Items = newcart.Items,
                        vm.MinOrderSubtotalWarning = newcart.MinOrderSubtotalWarning,
                        vm.OnePageCheckoutEnabled = newcart.OnePageCheckoutEnabled,
                        vm.OrderReviewData = newcart.OrderReviewData,
                        vm.ShowCheckoutAsGuestButton = newcart.ShowCheckoutAsGuestButton,
                        vm.ShowProductImages = newcart.ShowProductImages,
                        vm.ShowSku = newcart.ShowSku,
                        vm.TermsOfServiceOnOrderConfirmPage = newcart.TermsOfServiceOnOrderConfirmPage,
                        vm.TermsOfServiceOnShoppingCartPage = newcart.TermsOfServiceOnShoppingCartPage,
                        vm.TermsOfServicePopup = newcart.TermsOfServicePopup,
                        vm.Warnings = newcart.Warnings,
                        vm.DiscountBox = newcart.DiscountBox
                    checkoutAttributeChange();
                }).then(function () {
                    axios({
                        baseURL: '/vue/component',
                        method: 'get',
                        params: { component: 'OrderTotals' },
                    }).then(response => (
                        vm.DisplayTax = response.data.DisplayTax,
                        vm.DisplayTaxRates = response.data.DisplayTaxRates,
                        vm.GiftCards = response.data.GiftCards,
                        vm.OrderTotal = response.data.OrderTotal,
                        vm.OrderTotalDiscount = response.data.OrderTotalDiscount,
                        vm.PaymentMethodAdditionalFee = response.data.PaymentMethodAdditionalFee,
                        vm.RedeemedRewardPoints = response.data.RedeemedRewardPoints,
                        vm.RedeemedRewardPointsAmount = response.data.RedeemedRewardPointsAmount,
                        vm.RequiresShipping = response.data.RequiresShipping,
                        vm.SelectedShippingMethod = response.data.SelectedShippingMethod,
                        vm.Shipping = response.data.Shipping,
                        vm.SubTotal = response.data.SubTotal,
                        vm.SubTotalDiscount = response.data.SubTotalDiscount,
                        vm.Tax = response.data.Tax,
                        vm.TaxRates = response.data.TaxRates,
                        vm.WillEarnRewardPoints = response.data.WillEarnRewardPoints
                    ))
                });
            }
    </script>